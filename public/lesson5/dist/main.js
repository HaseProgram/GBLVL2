(()=>{"use strict";class t{constructor(t,e){this._text=t,this._callback=e}onBtnClick(){const t=this._callback;"function"==typeof t&&t()}getTemplate(){const t=document.createElement("button");return t.classList.add("btn"),t}render(t){if(t){const e=this.getTemplate();e.innerHTML=this._text,t.appendChild(e),e.addEventListener("click",(()=>{this.onBtnClick()}))}}}class e{constructor({name:t,price:e,img:n},s){this._name=t,this._price=e,this._img=n,this._CartInstane=s}addToCart(){this._CartInstane.add(this),console.log("Added!",this._name)}render(e){const n=document.createElement("div");n.innerHTML=`\n      Товар: ${this._name} = ${this._price}\n      <img src="${this._img}" />\n    `,new t("Добавить в корзину",this.addToCart.bind(this)).render(n),e.appendChild(n)}}class n{constructor({name:t,price:e}){this._name=t,this._price=e}render(t){const e=document.createElement("div");e.innerHTML=`Товар: ${this._name} : ${this._price} x ${this.counter}`,t.appendChild(e)}}const s=new class{add(t){const e=this._items.find((e=>e._name===t._name));e?e.counter++:this._items.push(new n({name:t._name,price:t._price})),this.render()}render(){const t=document.querySelector(".cart-list");t&&(t.innerHTML=""),this._items.forEach((e=>{e.render(t)}))}};new class{constructor(t){this._CartInstane=t,this.initShowMoreButton(),this.fetchGoods()}initShowMoreButton(){const t=document.querySelector("#showmore");t&&t.addEventListener("click",(()=>{this._page++,this.fetchGoods()}))}fetchGoods(){this.preloading=!0;const t=`http://localhost:4000/lesson5/database/items${this._page}.json`;return fetch(t).then((t=>t.json())).then((t=>{this.preloading=!1;const n=t.data.map((t=>new e(t,this._CartInstane)));return this._items=[...this._items,...n],this._items})).then(this.render.bind(this)).catch((t=>{alert(`No more pages, ${t}`)}))}render(){const t=document.querySelector(".goods-list");t&&(t.innerHTML="",this._items.forEach((e=>{e.render(t)})))}}(s)})();